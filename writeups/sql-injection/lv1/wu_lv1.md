# SQL Injection Level 1

## __1. Sử dụng như người dùng:__
Giao diện mới vào  
![](1.PNG)

Chỉ là giao diện đăng nhập.

## __2. Xem đằng sau chương trình:__
File `index.php`:  
```php
<?php
if (isset($_POST["username"]) && isset($_POST["password"])) {
    try {
        include "db.php";
        $sql = "SELECT username FROM users WHERE username='" .$_POST["username"] . "' AND password='" . $_POST["password"] ."'";
        $db_result = $database->query($sql);
        if ($db_result->num_rows > 0){
            $row = $db_result->fetch_assoc(); // Get the first row
            $username = $row["username"];
            if ($username === "admin") {
                $message = "Wow you can log in as admin, so cool, but how about <a href='level2.php'>THIS LEVEL</a>!";
            }
            else
                $message = "You log in as $username, but then what? You are not an admin";
        }
        else {
            $message = "Wrong username or password";
        }
    } catch(mysqli_sql_exception $e) {
        $message = $e->getMessage();
    }
}
?>
```
Nếu biến `$_POST["username"]` và `$_POST["password"]` được set &rarr; biến `$sql` là câu sql query lấy `username` trong table `users` qua `username` và `password` ở trên &rarr; `$db_result` là kết quả của query:
- Nếu số dòng trong `$db_result` <= 0 thì không có tài khoản nào hợp lệ, ngược lại thì:
    - Biến `$row` sẽ lấy dòng đầu tiên trong `$db_result`
    - Biến `$username` lấy từ dữ liệu `username` của biến `$row`
    - Kiểm tra nếu biến `$username` là `admin` thì đăng nhập thành công và qua lv2. Nếu không phải `admin` thì sẽ in ra thông báo "_Bạn đăng nhập thành công với `$username` nhưng không phải là `admin`_"


## __3. Lên ý tưởng và Khai thác:__
### a. <ins>Ý tưởng</ins>:
Bây giờ mình phải làm sao để có thể đăng nhập vào `admin` mà mình không cần `password` &rarr; `comment` hết ở phần `password` thì mình đã đăng nhập không cần `password` rồi.

### b. <ins>Khai thác</ins>:
Các kiểu `comment` sql:  
Link: https://www.w3schools.com/mysql/mysql_comments.asp
- `-- `: comment 1 dòng (phải có ký tự `space` ở phía sau)
- `#`: comment 1 dòng
- `/* */`: comment nhiều dòng

__Payload:__
```sql
admin'-- 
```
Mình sẽ dùng Payload vào `username input` và `password input` mình nhập bất kỳ.
![](2.PNG)

### __Giải thích:__  
Có vẻ như anh Dev đã dùng SQL query là: 
```sql
select username from <table chứa user> where username='<username input>' and password='<password input>'
```
Khi mình điền `payload` như trên vào thì câu query sẽ như này:
```sql
select username from <table chứa user> where username='admin'-- ' and password='<password input>'
```
Lúc này ở `where` điều kiện kiểm tra `username` đã đúng và phần kiểm tra password đã bị `comment` hết nên lệnh `select` đã được thực thi mà không cần `password`.